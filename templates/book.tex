\documentclass{tufte-book}

\usepackage[utf8]{inputenc}

\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}

\definecolor{darkblue}{HTML}{00416A}

\usepackage{longtable}
\usepackage{booktabs}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{boxedminipage}
\usepackage{microtype}
\usepackage{hyperref}
% attempts to prevent margin figures from being cut off
\usepackage{marginfix}
\usepackage[morefloats=100]{morefloats}

% My additions
\usepackage{thmtools}
\usepackage{mdframed}

\definecolor{amber}{rgb}{1.0, 0.49, 0.0}
\definecolor{cadmiumgreen}{rgb}{0.0, 0.42, 0.24}
\definecolor{darkcyan}{rgb}{0.0, 0.55, 0.55}
\definecolor{darkcoral}{rgb}{0.8, 0.36, 0.27}
\definecolor{azure}{rgb}{0.0, 0.5, 1.0}
\definecolor{bittersweet}{rgb}{1.0, 0.44, 0.37}
\definecolor{razzmatazz}{rgb}{0.89, 0.15, 0.42}
\definecolor{ballblue}{rgb}{0.13, 0.67, 0.8}
\definecolor{purple}{rgb}{0.2, 0.2, 0.6}
\definecolor{egyptianblue}{rgb}{0.06, 0.2, 0.65}
\definecolor{darkslategray}{rgb}{0.0, 0.29, 0.29}
\definecolor{bananayellow}{rgb}{1.0, 0.88, 0.21}
\definecolor{blue-violet}{rgb}{0.54, 0.17, 0.89}
\definecolor{carminepink}{rgb}{0.82, 0.41, 0.12}
\definecolor{titlecolor}{RGB}{0,74,147}
\definecolor{sectioncolor}{RGB}{0,129,255}
\definecolor{subsectioncolor}{RGB}{0,129,255}
\definecolor{definitioncolor}{rgb}{0.89, 0.0, 0.13}

% \newtheorem{Definition}{Definition}
% Definition style
\newtheoremstyle{definitionstyle}
  {\topsep} % Space above
  {\topsep} % Space below
  {} % Body font
  {} % Indent amount
  {\bfseries\color{definitioncolor}} % Theorem head font
  {} % Punctuation after theorem head
  {.5em} % Space after theorem head
  {} % Theorem head spec (can be left empty, meaning ‘normal’)

% Define mdframed settings
\mdfdefinestyle{definitionframe}{
  linecolor=definitioncolor,
  linewidth=2pt,
  frametitlerule=true,
  frametitlebackgroundcolor=gray!20,
  % backgroundcolor=azure!10,
  roundcorner=5pt,
  nobreak=true,
  topline=false,
  bottomline=false,
  rightline=false,
}
% Definition environment
\theoremstyle{definitionstyle}
\newtheorem{Definition}{Definition}
\surroundwithmdframed[style=definitionframe]{definition}

\newtheorem{Remark}{Remark}
\newtheorem{Theorem}{Theorem}
\newtheorem{Lemma}{Lemma}
\newtheorem{Exercise}{Exercise}
\newtheorem{Fact}{Fact}
\newtheorem{Proposition}{Proposition}
\newtheorem{Assumption}{Assumption}
\newtheorem*{Example}{Example}
\newenvironment{Algorithm}{\begin{center}\begin{boxedminipage}{0.92\textwidth}}{\end{boxedminipage}\end{center}}
\newenvironment{Proof}{\begin{proof}}{\end{proof}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}


% DO NOT DELETE. Required by pandoc.
% specific to pandoc 2.14 - adjust for other versions
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\input{templates/shared-macros}

$if(book-layout)$

\usepackage{ifthen}
\usepackage{chngcntr}
\counterwithout{figure}{chapter}
\counterwithout{table}{chapter}

% chapter format
\titleformat{\chapter}
  {\huge\rmfamily\itshape} % format applied to label+text
  {\thechapter} % label
  {0pt} % horizontal separation between label and title body
  {\ifshowchapternumber
   \textit{\textbf{\thechapter}}\linebreak\noindent
   \else
   \fi
   \setcounter{chapter}{\thechapter+1} }% before the title body
  []% after the title body

\hypersetup{
  colorlinks,
  linkcolor = darkblue,
  urlcolor = darkblue,
  pdftitle = {$booktitle$},
  pdfauthor = {$bookauthors$}
}

\title{$booktitle$}
\author{$bookauthors$}

\setcounter{tocdepth}{1}

\newif\ifshowchapternumber

\begin{document}

\frontmatter

\showchapternumberfalse

\thispagestyle{empty}

\begin{fullwidth}

~\vspace{4cm}

\noindent{\Huge\tt\uppercase{$booktitle$}}

\vspace{1cm}

\noindent{\huge\tt $booksubtitle$}

\vspace{3cm}

\noindent{\huge\it $bookauthors$}

\pagebreak

\thispagestyle{empty}

\noindent Created: $lastupdate$

\end{fullwidth}

\tableofcontents

\mainmatter

\showchapternumbertrue

$body$

\backmatter

\showchapternumberfalse

\listoffigures
\listoftables

$endif$

$if(chapter-layout)$

\hypersetup{
  colorlinks,
  linkcolor = darkblue,
  urlcolor = darkblue,
  pdftitle = {$booktitle$ - $title$},
  pdfauthor = {$bookauthors$}
}

\title{$booktitle$ - $lastupdate$}
\author{$bookauthors$}

\begin{document}

\noindent {\huge\textit{\textbf{$chapter-number$}}}

\vspace{1cm}

\noindent {\huge\it $title$}

\vspace{1.5cm}

$body$

$endif$

\end{document}
